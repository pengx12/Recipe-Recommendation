# Recipe Recommendation
## Architecture
The system works as a hybrid recommending system on both nutrition and flavour part. 
#### Nutrition Part
The nutritious recommendation is based on the users’ healthy condition and the ingredient-nutrition database. According to the calorie level assessed based on user’s body condition, we could get daily macronutrients goals for specific users. Users’ healthy goal, for example, losing weight or becoming stronger will also be asked and can be taken into consideration to recommend recipes that suits individual nutrition requirement. 
#### Flavour Part
As for the flavour part, the recipe will be projected into ingredients and the ingredients will be projected into compounds. Our system will calculate the similarity of ingredient compounds as well as simple ingredient as it usually tells more thing. We use TF-IDF and Cosine Similarity to calculate the similarity of ingredients in recipes and clustering to find the similarity of compounds in recipes. 
Based on user’s historical choice and rating, we will recommend similar results by content filtering method mentioned above. The result will be then mixed with Collaborative Filtering result by different proportions. In the process, users’ basic information, especially the regional information as well as cooking proficiency would make great contributions. 
Besides that, we add some rules to constrain the result sets. For example, same recipe need to be filtered out in a short time as people are always curious about new things and will not want to receive a same recipe.
## Assumption
The system works as a hybrid recommending system on both nutrition and flavour part. 
#### Nutrition part:
The nutrition part of recommendation is based on the users’ healthy condition and an ingredient-nutrition database. When user registers, we will ask for their basic information including sex, age, weight. Then our system will automatically calculate one’s Estimated Energy Requirements (EER). Refer to different activity level and fitness goal, we’ll introduce different weight factor and adjust the value of one’s EER correspondingly. Then the proportion and weight of nutrition can be calculated. In this way, the recipe can be adaptive to different fitness goal and suits individual nutrition requirements.
#### Flavour part:
##### Compound Assumption
Based on “Flavour network and the principles of food pairing” [1], we found that the flavor of cuisine are influenced by the compounds that ingredients contained. And the ingredients sharing similar compounds are more likely to taste better when combining them together. 
This hypothesis has already been used to find novel ingredient combinations and taken into use in some restaurants. We can find prove of it in most of the western countries. For instance, a combination of white chocolate and caviar, which share many flavour compounds like trimethylamine are always used in the same dish. 
Conversely, it seems that eastern people don’t like this kind of combination so much. We cannot find the same combination in the recipe of eastern cuisine.
In conclusion, our system assume that western people prefer the recipe combining ingredients with similar compounds and eastern person do not have the same preference.
##### Ingredient Assumption
The flavor of a recipe depends on the ingredients in it, especially the unique ones. So, identifying the uniqueness of an ingredient in a recipe is an effective way to define its importance and whether it is substitutable in the recipe. So in the recommendation, we will down weights the most commonly occurring ingredients and give higher weight to unique ones.
##### Local Food Assumption
Based on some basic investigation, people always prefer local food. In particular, we conclude that western people normally would prefer to give a try on exotic cuisine and the eastern people prefer local food. e.g. Western people would like to try Chinese food
##### Curiosity Assumption
People are instinctively curious about new things. We need to customize their model to find out what they may like. In the meantime we need to adapt the model to avoid it getting stuck into a restricted recommendation choice. Instead, our goal is to let people discover more possibility. 
In addition, as people can easily get bored, we will never recommend same food twice in a short time.
## Workflow
When user registers, the system will ask for people’s basic information like sex, age, region as well as activity level and fitness goals. The body condition information will be used to calculate Estimated Energy Requirements (EER) and the nutrition they need will be stored in the database while the region information will be used to infer what flavour would be suitable for the users.
Every time when the user selects one of our recommendation and give a rate, the information will be recorded. As the system knows users’ historical flavour, clustering algorithms like KNN, DBSCAN or Agglomerate Clustering on compounds in recipe can be implemented to find out what other recipes are similar to those recipes. Ingredient information are utilized by TF-IDF algorithm and Cosine similarity. We need to avoid giving recommendation of similar ingredients or similar compounds as people are always curious to try new things. Our system will generate two clustering sets. A smaller dataset which is extremely similar to one’s historical preference while the larger dataset has constrains on his/her hometown flavour and could find his/her potential preference. We mix the datasets using different proportion so that the users are not given a recommendation with similar ingredients or only dishes of their taste of home. Other users’ historical preference can also be utilized by Collaborative Filtering. 
The results with different filtering will be combined in a dataset, we will label each result with its filtering method (e.g. compound clustering, content filtering). When the user select one recipe, we will update the proportion weight of the different filtering results. For example if the recipe is recommended by smaller compounds clustering dataset, it might suggest that the user is satisfied with similar compounds recommendation and we can give more recommendation in that way. On the other hand, if the recipe is recommended by collaborative filtering, our system will reckon the user enjoying the similar taste which other users like. Otherwise he may be addicted to some ingredients and will always choose the result based on similar ingredients or the local food. The weight of these suggestions will be added in the next recommendation process. 
By calculation, we found that 3 dishes for a meal will be a good choice for people’s health. After mixing the different filtering results by different proportion, we will traverse the dataset to find the combination of 3 dishes that meet the nutrition demand based on the EER calculated by user’s body condition and then select the proper recipe group randomly as a recommendation choice.
## Algorithm
#### Compound Clustering
We try to cluster recipes into several categories based on compounds included. In this way we can recommend recipes in same cluster with recent highest rating. We use 3 historical recipes in the demo and the number can be changed during practical use. 
We tried KNN and aggregated clustering but finally decide to use Density-based spatial clustering of applications with noise (DBSCAN) as we do not need to assign how many clusters we need. In fact, we do not know the inner relation between recipes, and we do not have an assumption of how many categories we need or what the final clustering will be like. So, a density-based algorithm like DBSCAN is chosen. 
By adjusting the distance between nodes and minimum sample numbers, we can get two clustering result. The smaller one indicates the more similar recipe to the historical recipe and the larger one gives the user more possibility. The larger one will be restricted to the local food. People may find exotic cuisine with similar compounds and they can also find local food with different compounds. In this way, the users will not get stuck in a repetitive recommendation.
#### Ingredient Similarity Calculation
We tried to cluster recipes according to the ingredients, but as the data frame is too sparse, we did not get a good result. Then we chose to use term frequency–inverse document frequency (TF-IDF) to identify the uniqueness of an ingredient in a recipe to define its importance and whether it is substitutable in the recipe. In our system, we treated recipe as an article and ingredient as a word. We then calculated the TF-IDF value of every recipes and store the values. It will down weights the most commonly occurring ingredients and gives higher weight to unique ones. Based on the different weights we calculated Cosine similarity of recipe based on ingredients. Later we rank the recipes based on their similarity distance to user’s historical choice and select certain number of appropriate recipes as the result set based on ingredient.
For the Compound Clustering, we also use 3 historical recipes to calculate which can be changed in practice. A larger set and a smaller set related to the certain recipe based on the ranking will also be generated. The larger one will be mainly used for recommending local food.

